<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>FishBook ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 700px; margin: 30px auto; padding: 0 15px; }
        .form-group { margin: 12px 0; }
        label { display: block; margin-bottom: 4px; font-weight: bold; }
        input { width: 100%; padding: 8px; box-sizing: border-box; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; cursor: pointer; font-size: 16px; }
        button:hover { background: #45a049; }
        .catch-item { border: 1px solid #ccc; padding: 12px; margin: 10px 0; border-radius: 6px; }
        .catch-item img { max-width: 120px; margin-top: 8px; }
    </style>
</head>
<body>
    <h1>üêü FishBook ‚Äî –î–æ–±–∞–≤–∏—Ç—å —É–ª–æ–≤</h1>
    <form id="catchForm" enctype="multipart/form-data">
        <div class="form-group">
            <label>–í–µ—Å —Ä—ã–±—ã (–∫–≥):</label>
            <input type="number" name="weight_kg" step="0.1" required>
        </div>
        <div class="form-group">
            <label>–î–ª–∏–Ω–∞ —Ä—ã–±—ã (—Å–º):</label>
            <input type="number" name="length_cm" step="0.1" required>
        </div>
        <div class="form-group">
            <label>–§–æ—Ç–æ —Ä—ã–±—ã:</label>
            <input type="file" name="photo" accept="image/*">
        </div>
        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —É–ª–æ–≤</button>
    </form>

    <h2>–ú–æ–∏ —É–ª–æ–≤—ã</h2>
    <div id="catches-list"></div>
    <script>
        document.getElementById('catchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const weight = formData.get('weight_kg');
            const length = formData.get('length_cm');
            if (!weight || !length) {
                alert('–£–∫–∞–∂–∏—Ç–µ –≤–µ—Å –∏ –¥–ª–∏–Ω—É');
                return;
            }
            try {
                const res = await fetch('/api/catches', {
                    method: 'POST',
                    body: formData
                });
                if (res.ok) {
                    loadCatches();
                    e.target.reset();
                } else {
                    const err = await res.json();
                    alert(err.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                }
            } catch (err) {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —É–ª–æ–≤');
            }
        });

        async function loadCatches() {
            const res = await fetch('/api/catches');
            const catches = await res.json();
            const container = document.getElementById('catches-list');
            container.innerHTML = catches.map(c => 
                `<div class="catch-item">
                    <strong>–í–µ—Å:</strong> ${c.weight_kg} –∫–≥<br>
                    <strong>–î–ª–∏–Ω–∞:</strong> ${c.length_cm} —Å–º
                    ${c.photo_path ? `<br><img src="/${c.photo_path}" alt="–†—ã–±–∞">` : ""}
                </div>`
            ).join("");
        }

        loadCatches();
    </script>
</body>
</html>